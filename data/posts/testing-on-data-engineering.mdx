---
title: "üß™ Testing en Data Engineering"
date: "2022-04-24"
preview: "/assets/blog/testing-on-data-engineering/testing-data-logo.jpg"
tags:
  - "üë®‚Äçüíª Aprendizaje"
---

# üß™ Testing en Data Engineering

En estos √∫ltimos meses he visto la importancia de validaciones o tests a la hora
de trabajar con datos, pero claro, normalmente estar√°s acostumbrado a ver test
unitario, test de integraci√≥n o test e2e. Al empezar a aplicar test me di cuenta
de algo, resulta qu√© realmente el concepto es el mismo s√≥lo que cambia el
contexto. Voy a aplicarlos de manera abstracta para qu√© puedas hacerte una idea.

## Schema Testing

Consiste en comprobar si la estructura de los datos es realmente la correcta
antes de almacenar un dato, por ejemplo validar qu√© un campo ‚Äúemail‚Äù es del tipo
deseado `str` en el caso de Python, que no pueda ser null, o que cumpla con la
regex. Es un nivel b√°sico pero da un soporte de seguridad antes de almacenar
cualquier cosa incorrecta, siempre puedes equivocarte en una transformaci√≥n.

<MdxImage
  src="/assets/blog/testing-on-data-engineering/testing-data-2.png"
  alt="data-schema-example"
></MdxImage>

## Quality Testing

Lo primero a recalcar en este tipo de tests es qu√© es raro realizarlo de una
manera qu√© funcione siempre porque las reglas de negocio van cambiando a lo
largo del tiempo. En mi caso es el test qu√© m√°s aporta y el m√°s dif√≠cil de
generar, se podr√≠a empezar definiendo los casos l√≠mite que no se pueden dar en
los datos y continuando con criterios de aceptaci√≥n. Si el proceso es muy grande
o tiene muchas transformaciones, puede ser extremadamente dif√≠cil intuir qu√©
podr√≠a salir al final de dichas transformaciones. Visto desde otro punto de
vista, puede ser un test de e2e caja negra dond√© esperamos un resultado
aceptable, ap√≥yate siempre all√≠ d√≥nde haya el conocimiento de lo qu√© deber√≠a de
dar y ve refinando nadie tiene una f√≥rmula m√°gica para saber si realmente est√°
todo bien o mal.

<MdxImage
  src="/assets/blog/testing-on-data-engineering/testing-data-1.png"
  alt="data-quality-example"
></MdxImage>

## Contract Testing

Exportando la idea de c√≥mo se defin√≠an los contratos entre dos sistemas
separados, se puede aplicar a nuestro caso de uso. Un ejemplo muy bueno ser√≠a
por ejemplo si dentro de los datos vienen un conjunto de m√©tricas ‚ÄúA‚Äù y ‚ÄúB‚Äù, la
principal diferencia con los anteriores test consiste en mirar si realmente ‚ÄúA‚Äù
y ‚ÄúB‚Äù existen en los datos, por lo que antes de realizar alguna transformaci√≥n o
c√°lculo deberemos validar las fuentes.

<MdxImage
  src="/assets/blog/testing-on-data-engineering/testing-data-3.png"
  alt="data-contract-example"
></MdxImage>

En un mundo ideal se podr√≠a hablar con la fuente de los datos y establecer este
contrato, pero c√≥mo no siempre es el caso te comentar√© que existe el ‚ÄúConsumer
Driven Contract Testing‚Äù pero yo en mi caso adapto el concepto a la necesidad,
el cu√°l es un test defensivo por si solo te pasasen ‚ÄúA‚Äù, darnos el aviso antes
de qu√© sea tarde.

## Integrity Testing

Esto es para aquellos casos d√≥nde generamos fichero con claves for√°neas a otros
ficheros, por ejemplo tenemos una transformaci√≥n que nos genera los datos ya
listos y con un cierto tipo de estructura, para qu√© luego pueda ser migrado a la
base de datos. Este test lo qu√© har√° es que si tenemos un key en un fichero
deber√≠a de existir otra columna que hace referencia a la key en el otro. Esto me
parece super √∫til a la hora de hacer transformaciones de datos, ya qu√© nos
aporta un nivel m√°s de seguridad.

<MdxImage
  src="/assets/blog/testing-on-data-engineering/testing-data-4.png"
  alt="data-integrity-example"
></MdxImage>

## Regression Testing

La prueba de regresi√≥n es un tipo de prueba que se realiza para verificar que un
cambio de c√≥digo en el software no afecte la funcionalidad existente del
producto. Partimos del hecho de que los datos son algo vivo por lo tanto es muy
importante asegurarnos de que los datos de viejos cumplen con los criterios
adecuados.

Cada vez que los datos sufren un cambio y aparece una nueva versi√≥n/lanzamiento,
se deber√≠a realizar un sistema que pruebe la retrocompatibilidad de los datos
con respecto a las nuevas funcionalidades o transformaciones. Un ejemplo puede
describir mejor el problema:

<MdxImage
  src="/assets/blog/testing-on-data-engineering/testing-data-5.png"
  alt="data-regression-example"
></MdxImage>

## Conclusi√≥n

Tal c√≥mo lo veo Data Engineering tiene un campo muy amplio d√≥nde traer ideas de
testing y aportar mayor valor a tu trabajo, automatizando procesos y evitando
incertidumbre ya que escribir estos test har√° que puedas saber si algo est√° bien
o no ya qu√© ahora el test te lo dice.

Un saludo y os animo a buscar valor de los test en los datos tu empresa.
